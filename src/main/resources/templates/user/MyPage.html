<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{/fragments/layout}" lang="kr">

<head>
    <link rel="stylesheet" th:href="@{/css/user/MyPage.css}">
    <script type="text/javascript" th:src="@{/js/jquery-3.7.1.min.js}"></script>
    <script src="/js/user/MyPageUpload.js" defer></script>
    <script>
        function viewAwardResult(conNum) {
    $.ajax({
        url: '/users/contest/award/result', // 요청할 서버의 URL
        type: 'GET', // GET 요청 방식
        data: { conNum: conNum }, // 쿼리스트링으로 conNum 전송
        success: function(response) {

            // 응답 결과에서 contestNum을 가져와서 URL에 포함
            window.location.href = '/users/contest/result?contestNum=' + response.conNum;

        },
        error: function(xhr, status, error) {
            alert("콘테스트가 진행 중입니다. 모집 기간 종료 후 결과를 확인할 수 있습니다!");
        }
    });
}

    </script>
</head>
<th:block layout:fragment="content">
    <body>
    <!-- <banner>
        <img th:src="@{/img/banner.png}" alt="banner"  height="240px">
    </banner> -->
    <!--    <form method="get" action="/users/mypage">-->
    <main>
        <div class="container">
            <div class="sidebar">
                <form method="post" action="/users/mypage" enctype="multipart/form-data">
                    <input type="hidden" name="id" th:value="${myPageDTO?.id}">
                    <input type="hidden" name="userEmail" th:value="${myPageDTO?.userEmail}">
                    <!-- 프로필 사진 경로가 null일 경우 기본 이미지 표시 -->
                    <label class="profilePhoto" for="profilePhotoInput" title="파일 업로드">
                        <img id="profilePreview2" th:src="${myPageDTO?.profilePhotoPath}" alt="마이페이지 프로필 사진">
                    </label>
                    <input type="file" accept="image/*" name="profilePhoto" id="profilePhotoInput" onchange="previewImage2(event)">
                    <button type="submit" class="submit-button">이미지 저장</button>
                </form>
                <script>
                    // 이미지 미리보기
                    function previewImage2(event) {
                        const file = event.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                const output = document.getElementById('profilePreview2');
                                if (output) {
                                    output.src = e.target.result;  // 이미지가 로드되면 미리보기 설정
                                } else {
                                    console.error("profilePreview 요소를 찾을 수 없습니다.");
                                }
                            };
                            reader.readAsDataURL(file);
                        }
                    }
                </script>
                <div class="username">
                    <p th:if="${profile != null and profile?.userNickName != null}" th:text="${profile?.userNickName}"></p>
                </div>
                <div>
                    <p th:if="${profile != null and profile?.myPageUrl != null}" th:text="${profile?.myPageUrl}"></p>
                    <p th:if="${profile == null or profile?.myPageUrl == null}">정보 없음</p>
                </div>
                <a th:href="@{'/users/mypage/profile/edit/' + ${profile?.id}}" class="edit-profile">프로필 수정하기</a>
                <div class="activity">
                    <div class="section-title">
                        <h6>라우드 활동</h6>
                    </div>
                    <div>
                        연락 가능 시간: <p th:if="${profile != null and profile?.messageStart != null}" th:text="${profile?.messageStart}"></p>~
                        <p th:if="${profile == null or profile?.messageStart == null}">정보 없음</p>
                        <p th:if="${profile != null and profile?.messageEnd != null}" th:text="${profile?.messageEnd}"></p>
                        <p th:if="${profile == null or profile?.messageEnd == null}">정보 없음</p>
                    </div>
                </div>
            </div> <!-- sidebar end -->
            <div class="main-class">
                <div class="profileOneLiner">
                    <p th:if="${profile != null and profile?.profileOneLiner != null}" th:text="${profile?.profileOneLiner}"></p>
                </div>
                <div class="profileIntroduce">
                    <p th:if="${profile !=null and profile?.profileIntroduce != null}" th:text="${profile?.profileIntroduce}"></p>
                </div>

                <h3>내가 개최한 컨테스트 목록보기</h3>
                <table>
                    <thead>
                    <tr>
                        <th>No.</th>
                        <th>제목</th>
                        <th>모집 기간</th>
                        <th>조회수</th>
                        <th>바로 가기</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="contest : ${contestList}">
                        <td th:text="${contest.id}">1</td>
                        <td th:text="${contest.conTitle}">Contest Title</td>
                        <td th:text="${#dates.format(contest.conStartDate, 'yyyy-MM-dd')} + ' - ' + ${#dates.format(contest.conEndDate, 'yyyy-MM-dd')}">2024-09-25 ~ 2024-10-01</td>
                        <td th:text="${contest.conHit}">Hit</td>
                        <td>
                            <a th:href="@{/contest/view(contestNum=${contest.id})}" class="action-btn">바로가기</a>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <h3>내가 지원한 컨테스트 목록보기</h3>
                <table>
                    <thead>
                    <tr>
                        <th>Contest No.</th>
                        <th>제목</th>
                        <th>지원 날짜</th>
                        <th>결과 보기</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="applylist : ${applicationList}">
                        <td th:text="${applylist.conNum}">1</td>
                        <td th:text="${applylist.applyTitle}">Contest Title</td>
                        <td th:text="${#dates.format(applylist.applyDate, 'yyyy-MM-dd')}">2024-09-25</td>
                        <td>
                            <button type="button" th:onclick="'viewAwardResult(' + ${applylist.conNum} + ')'" class="action-btn">결과 보기</button>
                        </td>
                    </tr>
                    </tbody>
                </table>


            </div>
            <div class="button-class">
                <div class="profilesetting">
                    <a href="/users/mypage" class="underline">프로필 설정</a>
                </div>
                <div class="portfolio">
                    <a href="/users/mypage/portfolio" class="underline">포트폴리오</a>
                </div>
                <div class="upload">
                    <a href="/users/mypage/upload" class="underline">작품 업로드하기</a>
                </div>
            </div> <!-- button-class end -->
            <!--            <div class="management">-->
            <!--                <div><h6>참여한 공모전</h6><hr></div>-->
            <!--                <div class="imagecard"></div>-->
            <!--                <div class="imagecard"></div>-->
            <!--                <div class="imagecard"></div>-->
            <!--                <div class="imagecard"></div>-->
            <!--                <div class="imagecard"></div>-->

            <!--            </div>-->
            <!--            <div class="commition">-->
            <!--                <div><h6>공모전 의뢰 목록</h6><hr></div>-->
            <!--                <div class="commition1">-->
            <!--                    <div>회사를 차리는데 회사 이름 추천 해주세요~</div>-->
            <!--                    <div>회사를 차리는데 회사 이름 추천 해주세요~</div>-->
            <!--                    <div>회사를 차리는데 회사 이름 추천 해주세요~</div>-->
            <!--                    <div>회사를 차리는데 회사 이름 추천 해주세요~</div>-->
            <!--                    <div>회사를 차리는데 회사 이름 추천 해주세요~</div>-->
            <!--                    <div>회사를 차리는데 회사 이름 추천 해주세요~</div>-->
            <!--                    <div>회사를 차리는데 회사 이름 추천 해주세요~</div>-->
            <!--                </div>-->
            <!--            </div>-->


        </div> <!-- container end -->
    </main>
    <!--    </form>-->
    </body>
</th:block>

</html>
